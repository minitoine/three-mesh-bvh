let e,r,t,n,o,i,a,s,l,d,u,h,p,c;function f(e,r,t,n){Object.defineProperty(e,r,{get:t,set:n,enumerable:!0,configurable:!0})}var g=globalThis,m={},w={},y=g.parcelRequire4485;null==y&&((y=function(e){if(e in m)return m[e].exports;if(e in w){var r=w[e];delete w[e];var t={id:e,exports:{}};return m[e]=t,r.call(t.exports,t,t.exports),t.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,r){w[e]=r},g.parcelRequire4485=y);var x=y.register;x("27Lyk",function(e,r){f(e.exports,"register",()=>t,e=>t=e);var t,n=new Map;t=function(e,r){for(var t=0;t<r.length-1;t+=2)n.set(r[t],{baseUrl:e,path:r[t+1]})}}),x("c8CJQ",function(e,r){var t;e.exports,e.exports=((t=function(){function e(e){return o.appendChild(e.dom),e}function r(e){for(var r=0;r<o.children.length;r++)o.children[r].style.display=r===e?"block":"none";n=e}var n=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(e){e.preventDefault(),r(++n%o.children.length)},!1);var i=(performance||Date).now(),a=i,s=0,l=e(new t.Panel("FPS","#0ff","#002")),d=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var u=e(new t.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:o,addPanel:e,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(d.update(e-i,200),e>a+1e3&&(l.update(1e3*s/(e-a),100),a=e,s=0,u)){var r=performance.memory;u.update(r.usedJSHeapSize/1048576,r.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:o,setMode:r}}).Panel=function(e,r,t){var n=1/0,o=0,i=Math.round,a=i(window.devicePixelRatio||1),s=80*a,l=48*a,d=3*a,u=2*a,h=3*a,p=15*a,c=74*a,f=30*a,g=document.createElement("canvas");g.width=s,g.height=l,g.style.cssText="width:80px;height:48px";var m=g.getContext("2d");return m.font="bold "+9*a+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=t,m.fillRect(0,0,s,l),m.fillStyle=r,m.fillText(e,d,u),m.fillRect(h,p,c,f),m.fillStyle=t,m.globalAlpha=.9,m.fillRect(h,p,c,f),{dom:g,update:function(l,w){n=Math.min(n,l),o=Math.max(o,l),m.fillStyle=t,m.globalAlpha=1,m.fillRect(0,0,s,p),m.fillStyle=r,m.fillText(i(l)+" "+e+" ("+i(n)+"-"+i(o)+")",d,u),m.drawImage(g,h+a,p,c-a,f,h,p,c-a,f),m.fillRect(h+c-a,p,a,f),m.fillStyle=t,m.globalAlpha=.9,m.fillRect(h+c-a,p,a,i((1-l/w)*f))}}},t)}),x("77YCt",function(e,r){f(e.exports,"WorkerBase",()=>t);class t{constructor(e){this.name="WorkerBase",this.running=!1,this.worker=e,this.worker.onerror=e=>{if(e.message)throw Error(`${this.name}: Could not create Web Worker with error "${e.message}"`);throw Error(`${this.name}: Could not create Web Worker.`)}}runTask(){}generate(...e){if(this.running)throw Error("GenerateMeshBVHWorker: Already running job.");if(null===this.worker)throw Error("GenerateMeshBVHWorker: Worker has been disposed.");this.running=!0;let r=this.runTask(this.worker,...e);return r.finally(()=>{this.running=!1}),r}dispose(){this.worker.terminate(),this.worker=null}}}),x("8todg",function(e,r){f(e.exports,"GenerateMeshBVHWorker",()=>i);var t=y("ilwiq"),n=y("ff8ed"),o=y("77YCt");class i extends o.WorkerBase{constructor(){super(new Worker(y("bSef7"))),this.name="GenerateMeshBVHWorker"}runTask(e,r,o={}){return new Promise((i,a)=>{if(r.getAttribute("position").isInterleavedBufferAttribute||r.index&&r.index.isInterleavedBufferAttribute)throw Error("GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");e.onerror=e=>{a(Error(`GenerateMeshBVHWorker: ${e.message}`))},e.onmessage=s=>{let{data:l}=s;if(l.error)a(Error(l.error)),e.onmessage=null;else if(l.serialized){let{serialized:a,position:s}=l,d=(0,n.MeshBVH).deserialize(a,r,{setIndex:!1}),u=Object.assign({setBoundingBox:!0},o);if(r.attributes.position.array=s,a.index){if(r.index)r.index.array=a.index;else{let e=new t.BufferAttribute(a.index,1,!1);r.setIndex(e)}}u.setBoundingBox&&(r.boundingBox=d.getBoundingBox(new t.Box3)),o.onProgress&&o.onProgress(l.progress),i(d),e.onmessage=null}else o.onProgress&&o.onProgress(l.progress)};let s=r.index?r.index.array:null,l=r.attributes.position.array,d=[l];s&&d.push(s),e.postMessage({index:s,position:l,options:{...o,onProgress:null,includedProgressCallback:!!o.onProgress,groups:[...r.groups]}},d.map(e=>e.buffer).filter(e=>"undefined"==typeof SharedArrayBuffer||!(e instanceof SharedArrayBuffer)))})}}}),x("bSef7",function(e,r){var t=y("7ryUf");let n=new URL("generateMeshBVH.worker.17f4c1c5.js",import.meta.url);e.exports=t(n.toString(),n.origin,!0)}),x("7ryUf",function(e,r){e.exports=function(e,r,t){if(r===self.location.origin)return e;var n=t?"import "+JSON.stringify(e)+";":"importScripts("+JSON.stringify(e)+");";return URL.createObjectURL(new Blob([n],{type:"application/javascript"}))}}),x("5ca9G",function(e,r){f(e.exports,"MeshBVHHelper",()=>s);var t=y("ilwiq"),n=y("aw71y"),o=y("ff8ed");let i=new t.Box3;class a extends t.Object3D{get isMesh(){return!this.displayEdges}get isLineSegments(){return this.displayEdges}get isLine(){return this.displayEdges}constructor(e,r,n=10,o=0){super(),this.material=r,this.geometry=new t.BufferGeometry,this.name="MeshBVHRootHelper",this.depth=n,this.displayParents=!1,this.bvh=e,this.displayEdges=!0,this._group=o}raycast(){}update(){let e=this.geometry,r=this.bvh,o=this._group;if(e.dispose(),this.visible=!1,r){let a,s;let l=this.depth-1,d=this.displayParents,u=0;r.traverse((e,r)=>{if(e>=l||r)return u++,!0;d&&u++},o);let h=0,p=new Float32Array(24*u);r.traverse((e,r,t)=>{let o=e>=l||r;if(o||d){(0,n.arrayToBox)(0,t,i);let{min:e,max:r}=i;for(let t=-1;t<=1;t+=2){let n=t<0?e.x:r.x;for(let t=-1;t<=1;t+=2){let o=t<0?e.y:r.y;for(let t=-1;t<=1;t+=2){let i=t<0?e.z:r.z;p[h+0]=n,p[h+1]=o,p[h+2]=i,h+=3}}}return o}},o),s=new Uint8Array(this.displayEdges?[0,4,1,5,2,6,3,7,0,2,1,3,4,6,5,7,0,1,2,3,4,5,6,7]:[0,1,2,2,1,3,4,6,5,6,7,5,1,4,5,0,4,1,2,3,6,3,7,6,0,2,4,2,6,4,1,5,3,3,5,7]),a=p.length>65535?new Uint32Array(s.length*u):new Uint16Array(s.length*u);let c=s.length;for(let e=0;e<u;e++){let r=8*e,t=e*c;for(let e=0;e<c;e++)a[t+e]=r+s[e]}e.setIndex(new t.BufferAttribute(a,1,!1)),e.setAttribute("position",new t.BufferAttribute(p,3,!1)),this.visible=!0}}}class s extends t.Group{get color(){return this.edgeMaterial.color}get opacity(){return this.edgeMaterial.opacity}set opacity(e){this.edgeMaterial.opacity=e,this.meshMaterial.opacity=e}constructor(e=null,r=null,n=10){e instanceof o.MeshBVH&&(n=r||10,r=e,e=null),"number"==typeof r&&(n=r,r=null),super(),this.name="MeshBVHHelper",this.depth=n,this.mesh=e,this.bvh=r,this.displayParents=!1,this.displayEdges=!0,this._roots=[];let i=new t.LineBasicMaterial({color:65416,transparent:!0,opacity:.3,depthWrite:!1}),a=new t.MeshBasicMaterial({color:65416,transparent:!0,opacity:.3,depthWrite:!1});a.color=i.color,this.edgeMaterial=i,this.meshMaterial=a,this.update()}update(){let e=this.bvh||this.mesh.geometry.boundsTree,r=e?e._roots.length:0;for(;this._roots.length>r;){let e=this._roots.pop();e.geometry.dispose(),this.remove(e)}for(let t=0;t<r;t++){let{depth:r,edgeMaterial:n,meshMaterial:o,displayParents:i,displayEdges:s}=this;if(t>=this._roots.length){let o=new a(e,n,r,t);this.add(o),this._roots.push(o)}let l=this._roots[t];l.bvh=e,l.depth=r,l.displayParents=i,l.displayEdges=s,l.material=s?n:o,l.update()}}updateMatrixWorld(...e){let r=this.mesh,t=this.parent;null!==r&&(r.updateWorldMatrix(!0,!1),t?this.matrix.copy(t.matrixWorld).invert().multiply(r.matrixWorld):this.matrix.copy(r.matrixWorld),this.matrix.decompose(this.position,this.quaternion,this.scale)),super.updateMatrixWorld(...e)}copy(e){this.depth=e.depth,this.mesh=e.mesh,this.bvh=e.bvh,this.opacity=e.opacity,this.color.copy(e.color)}clone(){return new s(this.mesh,this.bvh,this.depth)}dispose(){this.edgeMaterial.dispose(),this.meshMaterial.dispose();let e=this.children;for(let r=0,t=e.length;r<t;r++)e[r].geometry.dispose()}}}),y("27Lyk").register(new URL("",import.meta.url).toString(),JSON.parse('["ggXQv","asyncGenerate.c8e6bcbb.js","6J6WW","generateMeshBVH.worker.17f4c1c5.js","acVmZ","generateMeshBVH.worker.aad48e6e.js","8UXAC","parallelMeshBVH.worker.03387c6a.js","acVmZ","generateMeshBVH.worker.aad48e6e.js","gr8Yf","asyncGenerate.22609466.js","j19h5","asyncGenerate.e8b1599c.js","30Pwg","asyncGenerate.77ce35af.js"]'));var B=y("ilwiq"),b=y("c8CJQ"),M=y("jiuw3"),B=y("ilwiq"),v=y("ff8ed"),k=y("77YCt"),S=y("2zRsl"),W=y("8todg"),H=y("aBE3W");const E="undefined"!=typeof navigator?navigator.hardwareConcurrency:4;var P={},A=y("7ryUf");let C=new URL("parallelMeshBVH.worker.03387c6a.js",import.meta.url);P=A(C.toString(),C.origin,!0);class V extends k.WorkerBase{constructor(){if(super(new Worker(P)),this.name="ParallelMeshBVHWorker",this.maxWorkerCount=Math.max(E,4),!(0,S.isSharedArrayBufferSupported)())throw Error("ParallelMeshBVHWorker: Shared Array Buffers are not supported.")}runTask(e,r,t={}){return new Promise((n,o)=>{if(r.index||t.indirect||(0,H.ensureIndex)(r,t),r.getAttribute("position").isInterleavedBufferAttribute||r.index&&r.index.isInterleavedBufferAttribute)throw Error("ParallelMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.");e.onerror=e=>{o(Error(`ParallelMeshBVHWorker: ${e.message}`))},e.onmessage=i=>{let{data:a}=i;if(a.error)o(Error(a.error)),e.onmessage=null;else if(a.serialized){let{serialized:o,position:i}=a,s=(0,v.MeshBVH).deserialize(o,r,{setIndex:!1}),l={setBoundingBox:!0,...t};if(r.attributes.position.array=i,o.index){if(r.index)r.index.array=o.index;else{let e=new B.BufferAttribute(o.index,1,!1);r.setIndex(e)}}l.setBoundingBox&&(r.boundingBox=s.getBoundingBox(new B.Box3)),t.onProgress&&t.onProgress(a.progress),n(s),e.onmessage=null}else t.onProgress&&t.onProgress(a.progress)};let i=r.index?r.index.array:null,a=r.attributes.position.array;e.postMessage({operation:"BUILD_BVH",maxWorkerCount:this.maxWorkerCount,index:(0,S.convertToBufferType)(i,SharedArrayBuffer),position:(0,S.convertToBufferType)(a,SharedArrayBuffer),options:{...t,onProgress:null,includedProgressCallback:!!t.onProgress,groups:[...r.groups]}})})}}class G{constructor(){if((0,S.isSharedArrayBufferSupported)())return new V;{console.warn("ParallelMeshBVHWorker: SharedArrayBuffers not supported. Falling back to single-threaded GenerateMeshBVHWorker.");let e=new W.GenerateMeshBVHWorker;return e.maxWorkerCount=E,e}}}var T=y("Mleu6"),v=y("ff8ed"),R=y("5ca9G");const j="undefined"!=typeof SharedArrayBuffer,I={useWebWorker:!0,maxWorkerCount:j?navigator.hardwareConcurrency:1,strategy:T.CENTER,radius:1,tube:.3,tubularSegments:500,radialSegments:500,p:3,q:5,displayHelper:!1,helperDepth:10};let L=!1;function F(){let e;if(L)return;L=!0,n&&(n.material.dispose(),n.geometry.dispose(),s.remove(n),s.remove(a));let r=window.performance.now(),t=window.performance.now();n=new B.Mesh(new B.TorusKnotGeometry(I.radius,I.tube,I.tubularSegments,I.radialSegments,I.p,I.q),new B.MeshStandardMaterial({color:new B.Color(5093036).convertSRGBToLinear(),roughness:.75}));let o=window.performance.now()-t,i=window.performance.now(),l={strategy:I.strategy};if(I.useWebWorker)c.maxWorkerCount=I.maxWorkerCount,c.generate(n.geometry,{onProgress:e=>{let r=(100*e).toFixed(0);u.style.visibility="visible",h.style.width=`${r}%`,p.innerText=`${r}%`},...l}).then(r=>{u.style.visibility="hidden",n.geometry.boundsTree=r,s.add(n);let t=window.performance.now()-i;L=!1,(a=new R.MeshBVHHelper(n,0)).depth=I.helperDepth,I.displayHelper&&a.update(),s.add(a),d.textContent=`Geometry Generation Time  : ${o.toFixed(3)}ms
BVH Generation Time       : ${t.toFixed(3)}ms
Frame Stall Time          : ${e.toFixed(3)}
SharedArrayBuffer Support : ${j}`}),e=window.performance.now()-r;else{n.geometry.boundsTree=new v.MeshBVH(n.geometry,l),e=window.performance.now()-r,s.add(n);let t=window.performance.now()-i;L=!1,(a=new R.MeshBVHHelper(n)).depth=I.helperDepth,a.update(),s.add(a),d.textContent=`Geometry Generation Time  : ${o.toFixed(3)}ms
BVH Generation Time       : ${t.toFixed(3)}ms
Frame Stall Time          : ${e.toFixed(3)}`}}(function(){d=document.getElementById("output"),u=document.getElementById("loading-container"),h=document.querySelector("#loading-container .bar"),p=document.querySelector("#loading-container .text"),(e=new B.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.setClearColor(16763432,1),e.outputEncoding=B.sRGBEncoding,document.body.appendChild(e.domElement),(t=new B.Scene).fog=new B.Fog(16763432,20,60);let n=new B.DirectionalLight(16777215,1);n.position.set(1,1,1),t.add(n),t.add(new B.AmbientLight(11583173,.8)),(r=new B.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,50)).position.set(0,0,4),r.far=100,r.updateProjectionMatrix(),o=new B.Clock,l=new(b&&b.__esModule?b.default:b),document.body.appendChild(l.dom),s=new B.Group,t.add(s);for(let e=0;e<400;e++){let e=new B.Mesh(new B.SphereGeometry(1,32,32),new B.MeshBasicMaterial);e.position.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).multiplyScalar(70),e.scale.setScalar(.3*Math.random()+.1),s.add(e)}c=new G,window.WORKER=c;let f=(i=new M.GUI).addFolder("helper");f.add(I,"displayHelper").name("enabled").onChange(e=>{e&&a&&a.update()}),f.add(I,"helperDepth",1,50,1).onChange(e=>{a&&(a.depth=e,a.update())}),f.open();let g=i.addFolder("knot");g.add(I,"radius",.5,2,.01),g.add(I,"tube",.2,1.2,.01),g.add(I,"tubularSegments",50,2e3,1),g.add(I,"radialSegments",5,2e3,1),g.add(I,"p",1,10,1),g.add(I,"q",1,10,1),g.open();let m=i.addFolder("bvh");m.add(I,"useWebWorker"),m.add(I,"maxWorkerCount",1,16,1).disable(!j),m.add(I,"strategy",{CENTER:T.CENTER,AVERAGE:T.AVERAGE,SAH:T.SAH}),i.add({regenerateKnot:F},"regenerateKnot").name("regenerate"),F(),window.addEventListener("resize",function(){r.aspect=window.innerWidth/window.innerHeight,r.updateProjectionMatrix(),e.setSize(window.innerWidth,window.innerHeight)},!1)})(),function n(){l.update(),requestAnimationFrame(n);let i=o.getDelta();s.rotation.x+=.4*i,s.rotation.y+=.6*i,a&&(a.visible=I.displayHelper),e.render(t,r)}();
//# sourceMappingURL=asyncGenerate.c8e6bcbb.js.map
