let e,t,i,a,r,o,n,l,s;var d=globalThis,c={},h={},p=d.parcelRequire4485;null==p&&((p=function(e){if(e in c)return c[e].exports;if(e in h){var t=h[e];delete h[e];var i={id:e,exports:{}};return c[e]=i,t.call(i.exports,i,i.exports),i.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){h[e]=t},d.parcelRequire4485=p);var m=p.register;m("c8CJQ",function(e,t){var i;e.exports,e.exports=((i=function(){function e(e){return r.appendChild(e.dom),e}function t(e){for(var t=0;t<r.children.length;t++)r.children[t].style.display=t===e?"block":"none";a=e}var a=0,r=document.createElement("div");r.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",r.addEventListener("click",function(e){e.preventDefault(),t(++a%r.children.length)},!1);var o=(performance||Date).now(),n=o,l=0,s=e(new i.Panel("FPS","#0ff","#002")),d=e(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new i.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:r,addPanel:e,showPanel:t,begin:function(){o=(performance||Date).now()},end:function(){l++;var e=(performance||Date).now();if(d.update(e-o,200),e>n+1e3&&(s.update(1e3*l/(e-n),100),n=e,l=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){o=this.end()},domElement:r,setMode:t}}).Panel=function(e,t,i){var a=1/0,r=0,o=Math.round,n=o(window.devicePixelRatio||1),l=80*n,s=48*n,d=3*n,c=2*n,h=3*n,p=15*n,m=74*n,u=30*n,y=document.createElement("canvas");y.width=l,y.height=s,y.style.cssText="width:80px;height:48px";var f=y.getContext("2d");return f.font="bold "+9*n+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=i,f.fillRect(0,0,l,s),f.fillStyle=t,f.fillText(e,d,c),f.fillRect(h,p,m,u),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(h,p,m,u),{dom:y,update:function(s,w){a=Math.min(a,s),r=Math.max(r,s),f.fillStyle=i,f.globalAlpha=1,f.fillRect(0,0,l,p),f.fillStyle=t,f.fillText(o(s)+" "+e+" ("+o(a)+"-"+o(r)+")",d,c),f.drawImage(y,h+n,p,m-n,u,h,p,m-n,u),f.fillRect(h+m-n,p,n,u),f.fillStyle=i,f.globalAlpha=.9,f.fillRect(h+m-n,p,n,o((1-s/w)*u))}}},i)}),m("5ca9G",function(e,t){Object.defineProperty(e.exports,"MeshBVHHelper",{get:()=>l,set:void 0,enumerable:!0,configurable:!0});var i=p("ilwiq"),a=p("aw71y"),r=p("ff8ed");let o=new i.Box3;class n extends i.Object3D{get isMesh(){return!this.displayEdges}get isLineSegments(){return this.displayEdges}get isLine(){return this.displayEdges}constructor(e,t,a=10,r=0){super(),this.material=t,this.geometry=new i.BufferGeometry,this.name="MeshBVHRootHelper",this.depth=a,this.displayParents=!1,this.bvh=e,this.displayEdges=!0,this._group=r}raycast(){}update(){let e=this.geometry,t=this.bvh,r=this._group;if(e.dispose(),this.visible=!1,t){let n,l;let s=this.depth-1,d=this.displayParents,c=0;t.traverse((e,t)=>{if(e>=s||t)return c++,!0;d&&c++},r);let h=0,p=new Float32Array(24*c);t.traverse((e,t,i)=>{let r=e>=s||t;if(r||d){(0,a.arrayToBox)(0,i,o);let{min:e,max:t}=o;for(let i=-1;i<=1;i+=2){let a=i<0?e.x:t.x;for(let i=-1;i<=1;i+=2){let r=i<0?e.y:t.y;for(let i=-1;i<=1;i+=2){let o=i<0?e.z:t.z;p[h+0]=a,p[h+1]=r,p[h+2]=o,h+=3}}}return r}},r),l=new Uint8Array(this.displayEdges?[0,4,1,5,2,6,3,7,0,2,1,3,4,6,5,7,0,1,2,3,4,5,6,7]:[0,1,2,2,1,3,4,6,5,6,7,5,1,4,5,0,4,1,2,3,6,3,7,6,0,2,4,2,6,4,1,5,3,3,5,7]),n=p.length>65535?new Uint32Array(l.length*c):new Uint16Array(l.length*c);let m=l.length;for(let e=0;e<c;e++){let t=8*e,i=e*m;for(let e=0;e<m;e++)n[i+e]=t+l[e]}e.setIndex(new i.BufferAttribute(n,1,!1)),e.setAttribute("position",new i.BufferAttribute(p,3,!1)),this.visible=!0}}}class l extends i.Group{get color(){return this.edgeMaterial.color}get opacity(){return this.edgeMaterial.opacity}set opacity(e){this.edgeMaterial.opacity=e,this.meshMaterial.opacity=e}constructor(e=null,t=null,a=10){e instanceof r.MeshBVH&&(a=t||10,t=e,e=null),"number"==typeof t&&(a=t,t=null),super(),this.name="MeshBVHHelper",this.depth=a,this.mesh=e,this.bvh=t,this.displayParents=!1,this.displayEdges=!0,this._roots=[];let o=new i.LineBasicMaterial({color:65416,transparent:!0,opacity:.3,depthWrite:!1}),n=new i.MeshBasicMaterial({color:65416,transparent:!0,opacity:.3,depthWrite:!1});n.color=o.color,this.edgeMaterial=o,this.meshMaterial=n,this.update()}update(){let e=this.bvh||this.mesh.geometry.boundsTree,t=e?e._roots.length:0;for(;this._roots.length>t;){let e=this._roots.pop();e.geometry.dispose(),this.remove(e)}for(let i=0;i<t;i++){let{depth:t,edgeMaterial:a,meshMaterial:r,displayParents:o,displayEdges:l}=this;if(i>=this._roots.length){let r=new n(e,a,t,i);this.add(r),this._roots.push(r)}let s=this._roots[i];s.bvh=e,s.depth=t,s.displayParents=o,s.displayEdges=l,s.material=l?a:r,s.update()}}updateMatrixWorld(...e){let t=this.mesh,i=this.parent;null!==t&&(t.updateWorldMatrix(!0,!1),i?this.matrix.copy(i.matrixWorld).invert().multiply(t.matrixWorld):this.matrix.copy(t.matrixWorld),this.matrix.decompose(this.position,this.quaternion,this.scale)),super.updateMatrixWorld(...e)}copy(e){this.depth=e.depth,this.mesh=e.mesh,this.bvh=e.bvh,this.opacity=e.opacity,this.color.copy(e.color)}clone(){return new l(this.mesh,this.bvh,this.depth)}dispose(){this.edgeMaterial.dispose(),this.meshMaterial.dispose();let e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].geometry.dispose()}}});var u=p("ilwiq"),y=p("7lx9d"),f=p("5Rd1x"),w=p("c8CJQ"),g=p("jiuw3"),v=p("ff8ed"),M=p("5ca9G"),S=p("jAT47");const x={displayCollider:!1,displayBVH:!1,displayParents:!1,visualizeDepth:10,gravity:-9.8,physicsSteps:5,simulationSpeed:1,sphereSize:1,pause:!1,step:()=>{let e=x.physicsSteps;for(let t=0;t<e;t++)L(.016/e)},explode:function(){let e=new u.Vector3;b.forEach(t=>{e.copy(t.position),e.y+=10,e.normalize(),t.velocity.addScaledVector(e,120)})},reset:function(){b.forEach(e=>{e.material.dispose(),e.geometry.dispose(),i.remove(e)}),b.length=0,V.forEach(e=>{e.material.dispose(),e.geometry.dispose(),i.remove(e)}),V.length=0}},b=[],V=[],P=new u.Sphere,E=new u.Vector3,B=new u.Vector3,C=new u.Vector3(0,0,1);function H(e,t,a,r,o,n=0){if(o<Math.max(Math.abs(.04*x.gravity),5))return;let l=2*Math.max(t?Math.max(e.collider.radius,t.collider.radius):e.collider.radius,.4),s=new u.Mesh(new u.RingGeometry(0,1,30),new u.MeshBasicMaterial({side:2,transparent:!0,depthWrite:!1}));s.lifetime=0,s.maxLifetime=.4,s.maxScale=l*Math.max(Math.sin(Math.min(o/200,1)*Math.PI/2),.35),s.position.copy(a).addScaledVector(r,n),s.quaternion.setFromUnitVectors(C,r),i.add(s),V.push(s)}function z(){let e=new u.Color(16777215),t=new u.Color(1251612).lerp(e,.5*Math.random()+.5).convertSRGBToLinear(),a=new u.Mesh(new u.SphereGeometry(1,20,20),new u.MeshStandardMaterial({color:t}));i.add(a),a.castShadow=!0,a.receiveShadow=!0,a.material.shadowSide=2;let r=.5*x.sphereSize*(.2*Math.random()+.6);return a.scale.setScalar(r),a.collider=new u.Sphere(a.position,r),a.velocity=new u.Vector3(0,0,0),a.mass=Math.pow(r,3)*Math.PI*4/3,b.push(a),a}function L(e){if(l){let t=x.physicsSteps;for(let a=0;a<t;a++)!function(e){let t=l.geometry.boundsTree;for(let a=0,r=b.length;a<r;a++){let o=b[a],n=o.collider;if(o.velocity.y+=x.gravity*e,n.center.addScaledVector(o.velocity,e),n.center.y<-80){b.splice(a,1),a--,r--,o.material.dispose(),o.geometry.dispose(),i.remove(o);continue}P.copy(o.collider);let l=!1;if(t.shapecast({intersectsBounds:e=>e.intersectsSphere(P),intersectsTriangle:e=>{e.closestPointToPoint(P.center,E),E.sub(P.center);let t=E.length();if(t<P.radius){let e=t-P.radius;E.multiplyScalar(1/t),P.center.addScaledVector(E,e),l=!0}},boundsTraverseOrder:e=>e.distanceToPoint(P.center)-P.radius}),l){E.subVectors(P.center,n.center).normalize(),o.velocity.reflect(E);let t=o.velocity.dot(E);o.velocity.addScaledVector(E,-(.5*t)),o.velocity.multiplyScalar(Math.max(1-e,0)),n.center.copy(P.center),B.copy(P.center).addScaledVector(E,-P.radius),H(o,null,B,E,t,.05)}}for(let e=0,t=b.length;e<t;e++){let i=b[e],a=i.collider;for(let r=e+1;r<t;r++){let e=b[r],t=e.collider;E.subVectors(a.center,t.center);let o=E.length()-(a.radius+t.radius);if(o<0){let r,n;E.normalize();let l=i.velocity.dot(E),s=e.velocity.dot(E),d=Math.max(l,.2),c=Math.max(s,.2),h=d+c,p=d/h,m=c/h;a.center.addScaledVector(E,-p*o),t.center.addScaledVector(E,m*o);let y=new u.Vector3;y.addScaledVector(E,-l).addScaledVector(E,s);let f=y.length(),w=i.mass,g=e.mass;y.dot(i.velocity)>y.dot(e.velocity)?(r=.5*f*(w-g)/(w+g),n=.5*f*2*w/(w+g),r-=f):(r=.5*f*2*g/(w+g),n=.5*f*(g-w)/(w+g)-f),y.normalize(),i.velocity.addScaledVector(y,r),e.velocity.addScaledVector(y,n),B.copy(a.center).addScaledVector(E,-a.radius),H(i,e,B,E,f,0)}}i.position.copy(a.center)}}(e/t)}for(let t=0,i=V.length;t<i;t++){let a=V[t];a.lifetime+=e;let r=a.lifetime/a.maxLifetime,o=Math.sin(4.5*r*Math.PI/4);o=1-Math.pow(1-o,2),a.scale.setScalar(o*a.maxScale),a.material.opacity=1-Math.sin(2*r*Math.PI/4),r>=1&&(V.splice(t,1),a.parent.remove(a),a.geometry.dispose(),a.material.dispose(),t--,i--)}}(function(){(e=new u.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.setClearColor(1251612,1),e.shadowMap.enabled=!0,e.shadowMap.type=u.PCFSoftShadowMap,e.outputEncoding=u.sRGBEncoding,document.body.appendChild(e.domElement),(i=new u.Scene).fog=new u.Fog(1251612,30,70);let d=new u.DirectionalLight(11193599,1);d.position.set(1,1.5,1).multiplyScalar(50),d.intensity=.25;let c=d.shadow.camera;c.bottom=c.left=-10,c.top=c.right=10,i.add(d),i.add(new u.HemisphereLight(4491519,2241348,.3)),(t=new u.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,50)).position.set(10,10,-10),t.far=100,t.updateProjectionMatrix(),window.camera=t,a=new u.Clock,new f.OrbitControls(t,e.domElement),o=new(w&&w.__esModule?w.default:w),document.body.appendChild(o.dom),new(0,y.GLTFLoader)().load("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/low-poly-jungle-scene/scene.gltf",e=>{(n=e.scene).scale.setScalar(.05);let t=new u.PointLight(65535);t.distance=7,t.position.set(-100,-40,100),n.add(t);let a=new u.PointLight(16768358);a.distance=15,a.intensity=5,a.position.set(80,80,135),a.shadow.normalBias=.01,a.shadow.bias=-.001,a.shadow.mapSize.setScalar(1024),a.castShadow=!0,n.add(a),n.updateMatrixWorld(!0);let r=new S.StaticGeometryGenerator(n);r.attributes=["position"];let o=r.generate();o.boundsTree=new v.MeshBVH(o),(l=new u.Mesh(o)).material.wireframe=!0,l.material.opacity=.5,l.material.transparent=!0,s=new M.MeshBVHHelper(l,x.visualizeDepth),i.add(s),i.add(l),i.add(n),n.traverse(e=>{e.material&&(e.castShadow=!0,e.receiveShadow=!0,e.material.shadowSide=2)})});let h=(r=new g.GUI).addFolder("Visualization");h.add(x,"displayCollider"),h.add(x,"displayBVH"),h.add(x,"displayParents").onChange(e=>{s.displayParents=e,s.update()}),h.add(x,"visualizeDepth",1,20,1).onChange(e=>{s.depth=e,s.update()}),h.open();let p=r.addFolder("Physics");p.add(x,"physicsSteps",0,30,1),p.add(x,"gravity",-100,100,.01).onChange(e=>{x.gravity=parseFloat(e)}),p.add(x,"simulationSpeed",0,5,.01),p.add(x,"sphereSize",.2,5,.1),p.add(x,"pause"),p.add(x,"step"),p.open(),r.add(x,"explode"),r.add(x,"reset"),r.open();let m=new u.Raycaster,b=new u.Vector2,V=0,P=0;e.domElement.addEventListener("pointerdown",e=>{V=e.clientX,P=e.clientY}),e.domElement.addEventListener("pointerup",e=>{if(Math.abs(e.clientX-V)+Math.abs(e.clientY-P)>2)return;b.x=e.clientX/window.innerWidth*2-1,b.y=-(e.clientY/window.innerHeight*2)+1,m.setFromCamera(b,t);let i=z();i.position.copy(t.position).addScaledVector(m.ray.direction,3),i.velocity.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).addScaledVector(m.ray.direction,10*Math.random()+15).multiplyScalar(.5)}),window.addEventListener("resize",function(){t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),e.setSize(window.innerWidth,window.innerHeight)},!1),window.createSphere=z})(),function r(){o.update(),requestAnimationFrame(r);let n=Math.min(a.getDelta(),.1);l&&(l.visible=x.displayCollider,s.visible=x.displayBVH,x.pause||L(x.simulationSpeed*n)),e.render(i,t)}();
//# sourceMappingURL=physics.3955b22d.js.map
