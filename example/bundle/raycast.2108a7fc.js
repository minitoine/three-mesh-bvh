let e,t,r,i,n,s,a,o;function l(e,t,r,i){Object.defineProperty(e,t,{get:r,set:i,enumerable:!0,configurable:!0})}var d=globalThis,h={},p={},c=d.parcelRequire4485;null==c&&((c=function(e){if(e in h)return h[e].exports;if(e in p){var t=p[e];delete p[e];var r={id:e,exports:{}};return h[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){p[e]=t},d.parcelRequire4485=c);var u=c.register;u("c8CJQ",function(e,t){var r;e.exports,e.exports=((r=function(){function e(e){return n.appendChild(e.dom),e}function t(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";i=e}var i=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),t(++i%n.children.length)},!1);var s=(performance||Date).now(),a=s,o=0,l=e(new r.Panel("FPS","#0ff","#002")),d=e(new r.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=e(new r.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:n,addPanel:e,showPanel:t,begin:function(){s=(performance||Date).now()},end:function(){o++;var e=(performance||Date).now();if(d.update(e-s,200),e>a+1e3&&(l.update(1e3*o/(e-a),100),a=e,o=0,h)){var t=performance.memory;h.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){s=this.end()},domElement:n,setMode:t}}).Panel=function(e,t,r){var i=1/0,n=0,s=Math.round,a=s(window.devicePixelRatio||1),o=80*a,l=48*a,d=3*a,h=2*a,p=3*a,c=15*a,u=74*a,m=30*a,y=document.createElement("canvas");y.width=o,y.height=l,y.style.cssText="width:80px;height:48px";var f=y.getContext("2d");return f.font="bold "+9*a+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=r,f.fillRect(0,0,o,l),f.fillStyle=t,f.fillText(e,d,h),f.fillRect(p,c,u,m),f.fillStyle=r,f.globalAlpha=.9,f.fillRect(p,c,u,m),{dom:y,update:function(l,g){i=Math.min(i,l),n=Math.max(n,l),f.fillStyle=r,f.globalAlpha=1,f.fillRect(0,0,o,c),f.fillStyle=t,f.fillText(s(l)+" "+e+" ("+s(i)+"-"+s(n)+")",d,h),f.drawImage(y,p+a,c,u-a,m,p,c,u-a,m),f.fillRect(p+u-a,c,a,m),f.fillStyle=r,f.globalAlpha=.9,f.fillRect(p+u-a,c,a,s((1-l/g)*m))}}},r)}),u("4h5hN",function(e,t){l(e.exports,"acceleratedRaycast",()=>d),l(e.exports,"computeBoundsTree",()=>h),l(e.exports,"disposeBoundsTree",()=>p);var r=c("ilwiq"),i=c("b4YKL"),n=c("ff8ed");let s=new r.Ray,a=new r.Matrix4,o=r.Mesh.prototype.raycast;function d(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;a.copy(this.matrixWorld).invert(),s.copy(e.ray).applyMatrix4(a);let r=this.geometry.boundsTree;if(!0===e.firstHitOnly){let n=(0,i.convertRaycastIntersect)(r.raycastFirst(s,this.material),this,e);n&&t.push(n)}else{let n=r.raycast(s,this.material);for(let r=0,s=n.length;r<s;r++){let s=(0,i.convertRaycastIntersect)(n[r],this,e);s&&t.push(s)}}}else o.call(this,e,t)}function h(e){return this.boundsTree=new n.MeshBVH(this,e),this.boundsTree}function p(){this.boundsTree=null}}),u("b4YKL",function(e,t){l(e.exports,"convertRaycastIntersect",()=>r);function r(e,t,r){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(r.ray.origin),e.object=t,e.distance<r.near||e.distance>r.far)?null:e}}),u("5ca9G",function(e,t){l(e.exports,"MeshBVHHelper",()=>o);var r=c("ilwiq"),i=c("aw71y"),n=c("ff8ed");let s=new r.Box3;class a extends r.Object3D{get isMesh(){return!this.displayEdges}get isLineSegments(){return this.displayEdges}get isLine(){return this.displayEdges}constructor(e,t,i=10,n=0){super(),this.material=t,this.geometry=new r.BufferGeometry,this.name="MeshBVHRootHelper",this.depth=i,this.displayParents=!1,this.bvh=e,this.displayEdges=!0,this._group=n}raycast(){}update(){let e=this.geometry,t=this.bvh,n=this._group;if(e.dispose(),this.visible=!1,t){let a,o;let l=this.depth-1,d=this.displayParents,h=0;t.traverse((e,t)=>{if(e>=l||t)return h++,!0;d&&h++},n);let p=0,c=new Float32Array(24*h);t.traverse((e,t,r)=>{let n=e>=l||t;if(n||d){(0,i.arrayToBox)(0,r,s);let{min:e,max:t}=s;for(let r=-1;r<=1;r+=2){let i=r<0?e.x:t.x;for(let r=-1;r<=1;r+=2){let n=r<0?e.y:t.y;for(let r=-1;r<=1;r+=2){let s=r<0?e.z:t.z;c[p+0]=i,c[p+1]=n,c[p+2]=s,p+=3}}}return n}},n),o=new Uint8Array(this.displayEdges?[0,4,1,5,2,6,3,7,0,2,1,3,4,6,5,7,0,1,2,3,4,5,6,7]:[0,1,2,2,1,3,4,6,5,6,7,5,1,4,5,0,4,1,2,3,6,3,7,6,0,2,4,2,6,4,1,5,3,3,5,7]),a=c.length>65535?new Uint32Array(o.length*h):new Uint16Array(o.length*h);let u=o.length;for(let e=0;e<h;e++){let t=8*e,r=e*u;for(let e=0;e<u;e++)a[r+e]=t+o[e]}e.setIndex(new r.BufferAttribute(a,1,!1)),e.setAttribute("position",new r.BufferAttribute(c,3,!1)),this.visible=!0}}}class o extends r.Group{get color(){return this.edgeMaterial.color}get opacity(){return this.edgeMaterial.opacity}set opacity(e){this.edgeMaterial.opacity=e,this.meshMaterial.opacity=e}constructor(e=null,t=null,i=10){e instanceof n.MeshBVH&&(i=t||10,t=e,e=null),"number"==typeof t&&(i=t,t=null),super(),this.name="MeshBVHHelper",this.depth=i,this.mesh=e,this.bvh=t,this.displayParents=!1,this.displayEdges=!0,this._roots=[];let s=new r.LineBasicMaterial({color:65416,transparent:!0,opacity:.3,depthWrite:!1}),a=new r.MeshBasicMaterial({color:65416,transparent:!0,opacity:.3,depthWrite:!1});a.color=s.color,this.edgeMaterial=s,this.meshMaterial=a,this.update()}update(){let e=this.bvh||this.mesh.geometry.boundsTree,t=e?e._roots.length:0;for(;this._roots.length>t;){let e=this._roots.pop();e.geometry.dispose(),this.remove(e)}for(let r=0;r<t;r++){let{depth:t,edgeMaterial:i,meshMaterial:n,displayParents:s,displayEdges:o}=this;if(r>=this._roots.length){let n=new a(e,i,t,r);this.add(n),this._roots.push(n)}let l=this._roots[r];l.bvh=e,l.depth=t,l.displayParents=s,l.displayEdges=o,l.material=o?i:n,l.update()}}updateMatrixWorld(...e){let t=this.mesh,r=this.parent;null!==t&&(t.updateWorldMatrix(!0,!1),r?this.matrix.copy(r.matrixWorld).invert().multiply(t.matrixWorld):this.matrix.copy(t.matrixWorld),this.matrix.decompose(this.position,this.quaternion,this.scale)),super.updateMatrixWorld(...e)}copy(e){this.depth=e.depth,this.mesh=e.mesh,this.bvh=e.bvh,this.opacity=e.opacity,this.color.copy(e.color)}clone(){return new o(this.mesh,this.bvh,this.depth)}dispose(){this.edgeMaterial.dispose(),this.meshMaterial.dispose();let e=this.children;for(let t=0,r=e.length;t<r;t++)e[t].geometry.dispose()}}});var m=c("c8CJQ"),y=c("jiuw3"),f=c("ilwiq"),g=c("4h5hN"),w=c("Mleu6"),x=c("5ca9G");f.Mesh.prototype.raycast=g.acceleratedRaycast,f.BufferGeometry.prototype.computeBoundsTree=g.computeBoundsTree,f.BufferGeometry.prototype.disposeBoundsTree=g.disposeBoundsTree;const M=[],v=[],b=new f.Raycaster,B=new f.SphereGeometry(.25,20,20),T=new f.CylinderGeometry(.01,.01);let S=null,E=0;const P={raycasters:{count:150,speed:1},mesh:{splitStrategy:w.CENTER,count:1,useBoundsTree:!0,visualizeBounds:!1,displayParents:!1,speed:1,visualBoundsDepth:10}};function R(){for(;v.length>P.raycasters.count;)v.pop().remove();for(;v.length<P.raycasters.count;)!function(){let e=new f.Object3D,r=new f.MeshBasicMaterial({color:16777215}),i=new f.Mesh(B,r),n=new f.Mesh(B,r);n.scale.multiplyScalar(.25),i.scale.multiplyScalar(.5);let s=new f.Mesh(T,new f.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.25}));e.add(s),e.add(i),e.add(n),t.add(e),i.position.set(25,0,0),e.rotation.x=10*Math.random(),e.rotation.y=10*Math.random(),e.rotation.z=10*Math.random();let a=new f.Vector3,l=new f.Vector3,d=Math.random()-.5,h=Math.random()-.5,p=Math.random()-.5;v.push({update:()=>{e.rotation.x+=1e-4*d*P.raycasters.speed*E,e.rotation.y+=1e-4*h*P.raycasters.speed*E,e.rotation.z+=1e-4*p*P.raycasters.speed*E,i.updateMatrixWorld(),a.setFromMatrixPosition(i.matrixWorld),l.copy(a).multiplyScalar(-1).normalize(),b.set(a,l),b.firstHitOnly=!0;let t=b.intersectObject(o,!0),r=t.length?t[0].distance:25;n.position.set(25-r,0,0),s.position.set(25-r/2,0,0),s.scale.set(1,r,1),s.rotation.z=Math.PI/2},remove:()=>{t.remove(e)}})}();if(!n)return;(!P.mesh.useBoundsTree&&n.boundsTree||n.boundsTree&&P.mesh.splitStrategy!==n.boundsTree.splitStrategy)&&n.disposeBoundsTree(),P.mesh.useBoundsTree&&!n.boundsTree&&(console.time("computing bounds tree"),n.computeBoundsTree({maxLeafTris:5,strategy:parseFloat(P.mesh.splitStrategy)}),n.boundsTree.splitStrategy=P.mesh.splitStrategy,console.timeEnd("computing bounds tree"),a&&a.update());let e=M.length;for(;M.length>P.mesh.count;)o.remove(M.pop());for(;M.length<P.mesh.count;)!function(){let e=new f.Mesh(n,s);e.rotation.x=10*Math.random(),e.rotation.y=10*Math.random(),M.push(e),o.add(e)}();if(e!==M.length){let e=(M.length-1)/299,t=0+2*e,r=1+-.8*e;M.forEach(e=>{e.scale.set(1,1,1).multiplyScalar(r);let i=new f.Vector3(0,1,0);i.applyAxisAngle(new f.Vector3(1,0,0),Math.PI*Math.random()),i.applyAxisAngle(new f.Vector3(0,1,0),2*Math.PI*Math.random()),i.multiplyScalar(t),e.position.set(i.x,i.y,i.z)})}let r=P.mesh.visualizeBounds&&n.boundsTree;a&&!r&&(o.remove(a),a=null),!a&&r&&(a=new x.MeshBVHHelper(M[0]),o.add(a)),a&&(a.depth=P.mesh.visualBoundsDepth,a.displayParents=P.mesh.displayParents,a.update())}(function(){(e=new f.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.setClearColor(1251612,1),document.body.appendChild(e.domElement),(t=new f.Scene).fog=new f.Fog(1251612,20,60);let a=new f.DirectionalLight(16777215,.5);a.position.set(1,1,1),t.add(a),t.add(new f.AmbientLight(16777215,.4)),o=new f.Object3D,n=new f.TorusKnotGeometry(1,.4,400,100),s=new f.MeshPhongMaterial({color:15277667}),o.scale.multiplyScalar(10),o.rotation.x=10.989999999999943,o.rotation.y=10.989999999999943,t.add(o),(i=new f.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,50)).position.z=40,i.far=100,i.updateProjectionMatrix(),r=new(m&&m.__esModule?m.default:m),document.body.appendChild(r.dom);let l=new y.GUI,d=l.addFolder("Raycasters");d.add(P.raycasters,"count").min(1).max(1e3).step(1).onChange(()=>R()),d.add(P.raycasters,"speed").min(0).max(20),d.open();let h=l.addFolder("Mesh");h.add(P.mesh,"useBoundsTree").onChange(()=>R()),h.add(P.mesh,"splitStrategy",{CENTER:w.CENTER,SAH:w.SAH,AVERAGE:w.AVERAGE}).onChange(()=>R()),h.add(P.mesh,"count").min(1).max(300).step(1).onChange(()=>R()),h.add(P.mesh,"speed").min(0).max(20),h.add(P.mesh,"visualizeBounds").onChange(()=>R()),h.add(P.mesh,"displayParents").onChange(()=>R()),h.add(P.mesh,"visualBoundsDepth").min(1).max(20).step(1).onChange(()=>R()),h.open(),window.addEventListener("resize",function(){i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),e.setSize(window.innerWidth,window.innerHeight)},!1)})(),R(),function n(){r.begin();let s=window.performance.now();S=S||s,E=s-S,o.rotation.x+=1e-4*P.mesh.speed*E,o.rotation.y+=1e-4*P.mesh.speed*E,o.children.forEach(e=>{e.rotation.x+=1e-4*P.mesh.speed*E,e.rotation.y+=1e-4*P.mesh.speed*E}),o.updateMatrixWorld(),v.forEach(e=>e.update()),e.render(t,i),S=s,r.end(),requestAnimationFrame(n)}();
//# sourceMappingURL=raycast.2108a7fc.js.map
