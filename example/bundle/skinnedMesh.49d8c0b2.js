let e,t,i,r,a,n,o,s,l,d,p,h,c,u,m,f,y,w;function g(e,t,i,r){Object.defineProperty(e,t,{get:i,set:r,enumerable:!0,configurable:!0})}var x=globalThis,b={},v={},M=x.parcelRequire4485;null==M&&((M=function(e){if(e in b)return b[e].exports;if(e in v){var t=v[e];delete v[e];var i={id:e,exports:{}};return b[e]=i,t.call(i.exports,i,i.exports),i.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){v[e]=t},x.parcelRequire4485=M);var S=M.register;S("c8CJQ",function(e,t){var i;e.exports,e.exports=((i=function(){function e(e){return a.appendChild(e.dom),e}function t(e){for(var t=0;t<a.children.length;t++)a.children[t].style.display=t===e?"block":"none";r=e}var r=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",function(e){e.preventDefault(),t(++r%a.children.length)},!1);var n=(performance||Date).now(),o=n,s=0,l=e(new i.Panel("FPS","#0ff","#002")),d=e(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var p=e(new i.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:a,addPanel:e,showPanel:t,begin:function(){n=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(d.update(e-n,200),e>o+1e3&&(l.update(1e3*s/(e-o),100),o=e,s=0,p)){var t=performance.memory;p.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){n=this.end()},domElement:a,setMode:t}}).Panel=function(e,t,i){var r=1/0,a=0,n=Math.round,o=n(window.devicePixelRatio||1),s=80*o,l=48*o,d=3*o,p=2*o,h=3*o,c=15*o,u=74*o,m=30*o,f=document.createElement("canvas");f.width=s,f.height=l,f.style.cssText="width:80px;height:48px";var y=f.getContext("2d");return y.font="bold "+9*o+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=i,y.fillRect(0,0,s,l),y.fillStyle=t,y.fillText(e,d,p),y.fillRect(h,c,u,m),y.fillStyle=i,y.globalAlpha=.9,y.fillRect(h,c,u,m),{dom:f,update:function(l,w){r=Math.min(r,l),a=Math.max(a,l),y.fillStyle=i,y.globalAlpha=1,y.fillRect(0,0,s,c),y.fillStyle=t,y.fillText(n(l)+" "+e+" ("+n(r)+"-"+n(a)+")",d,p),y.drawImage(f,h+o,c,u-o,m,h,c,u-o,m),y.fillRect(h+u-o,c,o,m),y.fillStyle=i,y.globalAlpha=.9,y.fillRect(h+u-o,c,o,n((1-l/w)*m))}}},i)}),S("4h5hN",function(e,t){g(e.exports,"acceleratedRaycast",()=>l),g(e.exports,"computeBoundsTree",()=>d),g(e.exports,"disposeBoundsTree",()=>p);var i=M("ilwiq"),r=M("b4YKL"),a=M("ff8ed");let n=new i.Ray,o=new i.Matrix4,s=i.Mesh.prototype.raycast;function l(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;o.copy(this.matrixWorld).invert(),n.copy(e.ray).applyMatrix4(o);let i=this.geometry.boundsTree;if(!0===e.firstHitOnly){let a=(0,r.convertRaycastIntersect)(i.raycastFirst(n,this.material),this,e);a&&t.push(a)}else{let a=i.raycast(n,this.material);for(let i=0,n=a.length;i<n;i++){let n=(0,r.convertRaycastIntersect)(a[i],this,e);n&&t.push(n)}}}else s.call(this,e,t)}function d(e){return this.boundsTree=new a.MeshBVH(this,e),this.boundsTree}function p(){this.boundsTree=null}}),S("b4YKL",function(e,t){g(e.exports,"convertRaycastIntersect",()=>i);function i(e,t,i){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(i.ray.origin),e.object=t,e.distance<i.near||e.distance>i.far)?null:e}}),S("38WKP",function(e,t){g(e.exports,"getBVHExtremes",()=>n),g(e.exports,"estimateMemoryInBytes",()=>o),M("ilwiq");var i=M("Mleu6");M("aw71y");var r=M("2zRsl");function a(e){switch(typeof e){case"number":return 8;case"string":return 2*e.length;case"boolean":return 4;default:return 0}}function n(e){return e._roots.map((t,r)=>(function(e,t){let r={nodeCount:0,leafNodeCount:0,depth:{min:1/0,max:-1/0},tris:{min:1/0,max:-1/0},splits:[0,0,0],surfaceAreaScore:0};return e.traverse((e,t,a,n,o)=>{let s=a[3]-a[0],l=a[4]-a[1],d=a[5]-a[2],p=2*(s*l+l*d+d*s);r.nodeCount++,t?(r.leafNodeCount++,r.depth.min=Math.min(e,r.depth.min),r.depth.max=Math.max(e,r.depth.max),r.tris.min=Math.min(o,r.tris.min),r.tris.max=Math.max(o,r.tris.max),r.surfaceAreaScore+=p*i.TRIANGLE_INTERSECT_COST*o):(r.splits[n]++,r.surfaceAreaScore+=p*i.TRAVERSAL_COST)},t),r.tris.min===1/0&&(r.tris.min=0,r.tris.max=0),r.depth.min===1/0&&(r.depth.min=0,r.depth.max=0),r})(e,r))}function o(e){let t=new Set,i=[e],n=0;for(;i.length;){let e=i.pop();if(!t.has(e))for(let o in t.add(e),e){if(!e.hasOwnProperty(o))continue;n+=a(o);let t=e[o];t&&("object"==typeof t||"function"==typeof t)?/(Uint|Int|Float)(8|16|32)Array/.test(t.constructor.name)?n+=t.byteLength:(0,r.isSharedArrayBufferSupported)()&&t instanceof SharedArrayBuffer?n+=t.byteLength:t instanceof ArrayBuffer?n+=t.byteLength:i.push(t):n+=a(t)}}return n}}),S("5ca9G",function(e,t){g(e.exports,"MeshBVHHelper",()=>s);var i=M("ilwiq"),r=M("aw71y"),a=M("ff8ed");let n=new i.Box3;class o extends i.Object3D{get isMesh(){return!this.displayEdges}get isLineSegments(){return this.displayEdges}get isLine(){return this.displayEdges}constructor(e,t,r=10,a=0){super(),this.material=t,this.geometry=new i.BufferGeometry,this.name="MeshBVHRootHelper",this.depth=r,this.displayParents=!1,this.bvh=e,this.displayEdges=!0,this._group=a}raycast(){}update(){let e=this.geometry,t=this.bvh,a=this._group;if(e.dispose(),this.visible=!1,t){let o,s;let l=this.depth-1,d=this.displayParents,p=0;t.traverse((e,t)=>{if(e>=l||t)return p++,!0;d&&p++},a);let h=0,c=new Float32Array(24*p);t.traverse((e,t,i)=>{let a=e>=l||t;if(a||d){(0,r.arrayToBox)(0,i,n);let{min:e,max:t}=n;for(let i=-1;i<=1;i+=2){let r=i<0?e.x:t.x;for(let i=-1;i<=1;i+=2){let a=i<0?e.y:t.y;for(let i=-1;i<=1;i+=2){let n=i<0?e.z:t.z;c[h+0]=r,c[h+1]=a,c[h+2]=n,h+=3}}}return a}},a),s=new Uint8Array(this.displayEdges?[0,4,1,5,2,6,3,7,0,2,1,3,4,6,5,7,0,1,2,3,4,5,6,7]:[0,1,2,2,1,3,4,6,5,6,7,5,1,4,5,0,4,1,2,3,6,3,7,6,0,2,4,2,6,4,1,5,3,3,5,7]),o=c.length>65535?new Uint32Array(s.length*p):new Uint16Array(s.length*p);let u=s.length;for(let e=0;e<p;e++){let t=8*e,i=e*u;for(let e=0;e<u;e++)o[i+e]=t+s[e]}e.setIndex(new i.BufferAttribute(o,1,!1)),e.setAttribute("position",new i.BufferAttribute(c,3,!1)),this.visible=!0}}}class s extends i.Group{get color(){return this.edgeMaterial.color}get opacity(){return this.edgeMaterial.opacity}set opacity(e){this.edgeMaterial.opacity=e,this.meshMaterial.opacity=e}constructor(e=null,t=null,r=10){e instanceof a.MeshBVH&&(r=t||10,t=e,e=null),"number"==typeof t&&(r=t,t=null),super(),this.name="MeshBVHHelper",this.depth=r,this.mesh=e,this.bvh=t,this.displayParents=!1,this.displayEdges=!0,this._roots=[];let n=new i.LineBasicMaterial({color:65416,transparent:!0,opacity:.3,depthWrite:!1}),o=new i.MeshBasicMaterial({color:65416,transparent:!0,opacity:.3,depthWrite:!1});o.color=n.color,this.edgeMaterial=n,this.meshMaterial=o,this.update()}update(){let e=this.bvh||this.mesh.geometry.boundsTree,t=e?e._roots.length:0;for(;this._roots.length>t;){let e=this._roots.pop();e.geometry.dispose(),this.remove(e)}for(let i=0;i<t;i++){let{depth:t,edgeMaterial:r,meshMaterial:a,displayParents:n,displayEdges:s}=this;if(i>=this._roots.length){let a=new o(e,r,t,i);this.add(a),this._roots.push(a)}let l=this._roots[i];l.bvh=e,l.depth=t,l.displayParents=n,l.displayEdges=s,l.material=s?r:a,l.update()}}updateMatrixWorld(...e){let t=this.mesh,i=this.parent;null!==t&&(t.updateWorldMatrix(!0,!1),i?this.matrix.copy(i.matrixWorld).invert().multiply(t.matrixWorld):this.matrix.copy(t.matrixWorld),this.matrix.decompose(this.position,this.quaternion,this.scale)),super.updateMatrixWorld(...e)}copy(e){this.depth=e.depth,this.mesh=e.mesh,this.bvh=e.bvh,this.opacity=e.opacity,this.color.copy(e.color)}clone(){return new s(this.mesh,this.bvh,this.depth)}dispose(){this.edgeMaterial.dispose(),this.meshMaterial.dispose();let e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].geometry.dispose()}}});var B=M("ilwiq"),T=M("7lx9d"),H=M("c8CJQ"),A=M("jiuw3"),R=M("4h5hN"),P=M("38WKP"),C=M("5ca9G"),E=M("jAT47"),L=M("5Rd1x");B.BufferGeometry.prototype.computeBoundsTree=R.computeBoundsTree;const W={display:!0,displayOriginal:!0,material:"wireframe",updatePositionOnly:!1,skeletonHelper:!1,bvhHelper:!0,bvhHelperDepth:10,autoUpdate:!0,updateRate:2.5,pause:!1,regenerate:()=>{F()}};let O=0,_=null;function F(){if(u){let e,t,i;i=window.performance.now(),m.generate(u.geometry),e=window.performance.now()-i,i=window.performance.now(),u.geometry.boundsTree?(u.geometry.boundsTree.refit(),t=(window.performance.now()-i).toFixed(2)):(u.geometry.computeBoundsTree(),t="-"),h.update(),O=0;let r=(0,P.getBVHExtremes)(u.geometry.boundsTree);null===_&&(_=r);let a=0,n=0;for(let e in r)a+=r[e].surfaceAreaScore,n+=_[e].surfaceAreaScore;let s=a/n-1;o.innerHTML=`mesh generation time: ${e.toFixed(2)} ms
refit time: ${t} ms
bvh degradation: ${(100*s).toFixed(2)}%`}}(function(){o=document.getElementById("output"),(e=new B.WebGLRenderer({antialias:!0})).setPixelRatio(window.devicePixelRatio),e.setSize(window.innerWidth,window.innerHeight),e.setClearColor(1118481,1),e.shadowMap.enabled=!0,e.shadowMap.type=B.PCFSoftShadowMap,e.outputEncoding=B.sRGBEncoding,document.body.appendChild(e.domElement),i=new B.Scene;let g=new B.DirectionalLight(16777215,1);g.position.set(5,5,2.5),g.shadow.mapSize.setScalar(1024),g.shadow.normalBias=.01,g.castShadow=!0;let x=g.shadow.camera;x.left=x.bottom=-7.5,x.right=x.top=7.5,x.updateProjectionMatrix(),i.add(g),i.add(new B.AmbientLight(11583173,.8)),(t=new B.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,50)).position.set(10,0,0),t.far=100,t.updateProjectionMatrix(),s=new L.OrbitControls(t,e.domElement),r=new B.Clock,n=new(H&&H.__esModule?H.default:H),document.body.appendChild(n.dom),new(0,T.GLTFLoader)().load("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/trex/scene.gltf",e=>{(p=e.scene).traverse(e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0,e.frustumCulled=!1)}),p.updateMatrixWorld(!0),i.add(p),(c=new B.SkeletonHelper(p)).visible=!1,i.add(c);let r=e.animations;(d=(l=new B.AnimationMixer(p)).clipAction(r[0])).play(),d.paused=W.pause;let a=new B.Box3;a.setFromObject(p),a.getCenter(s.target),a.getCenter(t.position),t.position.x=7.5,t.position.z=3.5,s.update(),y=(w=(m=new E.StaticGeometryGenerator(p)).getMaterials()).map(e=>new B.MeshNormalMaterial({normalMap:e.normalMap})),f=new B.MeshBasicMaterial({wireframe:!0,transparent:!0,opacity:.05,depthWrite:!1}),(u=new B.Mesh(new B.BufferGeometry,f)).receiveShadow=!0,i.add(u),h=new C.MeshBVHHelper(u,10),i.add(h),F()});let b=new B.Mesh(new B.PlaneBufferGeometry,new B.ShadowMaterial({color:16777215,opacity:.025,transparent:!0}));b.rotation.x=-Math.PI/2,b.receiveShadow=!0,b.scale.setScalar(50),i.add(b);let v=(a=new A.GUI).addFolder("static mesh");v.add(W,"display"),v.add(W,"displayOriginal"),v.add(W,"material",["wireframe","normal","original"]).onChange(e=>{if(u)switch(e){case"wireframe":u.material=f,u.castShadow=!1;break;case"normal":u.material=y,u.castShadow=!0;break;case"original":u.material=w,u.castShadow=!0}}),v.add(W,"updatePositionOnly").onChange(e=>{m.attributes=e?["position"]:["position","normal","tangent","uv","uv2"];let t=u.geometry;for(let e in t.dispose(),t.attributes)t.deleteAttribute(e)}),v.open();let M=a.addFolder("helpers");M.add(W,"skeletonHelper"),M.add(W,"bvhHelper"),M.add(W,"bvhHelperDepth",1,20,1).onChange(e=>{h.depth=parseInt(e),h.update()}),M.open();let S=a.addFolder("bvh animation");S.add(W,"autoUpdate"),S.add(W,"updateRate",0,5,.001),S.add(W,"pause").onChange(e=>{d&&(d.paused=e)}),S.add(W,"regenerate"),S.open(),a.open(),window.addEventListener("resize",function(){t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),e.setSize(window.innerWidth,window.innerHeight)},!1)})(),function a(){n.update(),requestAnimationFrame(a);let o=Math.min(r.getDelta(),.03);l&&(l.update(o),c.visible=W.skeletonHelper,u.visible=W.display,h.visible=W.bvhHelper,p.visible=W.displayOriginal),i.updateMatrixWorld(!0),W.autoUpdate&&!W.pause?(O>W.updateRate&&F(),O+=o):O=0,e.render(i,t)}();
//# sourceMappingURL=skinnedMesh.49d8c0b2.js.map
